{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://fieldscout-copilot/contracts/schemas/Observation.json",
  "title": "Observation",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "observationId",
    "deviceId",
    "createdAt",
    "captureMode",
    "rawNoteText",
    "transcription",
    "extraction",
    "normalization",
    "location",
    "status",
    "schemaVersion",
    "deterministicChecksum"
  ],
  "properties": {
    "observationId": {
      "type": "string",
      "pattern": "^obs_[0-9]{8}_[0-9]{4}$"
    },
    "deviceId": {
      "type": "string",
      "pattern": "^dev_[a-z0-9_]+$"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    },
    "captureMode": {
      "type": "string",
      "enum": ["voice", "typed"]
    },
    "rawNoteText": {
      "type": "string",
      "minLength": 1
    },
    "transcription": {
      "type": "object",
      "additionalProperties": false,
      "required": ["text", "source", "confidence"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1
        },
        "source": {
          "type": "string",
          "enum": ["on_device_asr", "manual_typed", "none"]
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "extraction": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "crop",
        "fieldBlock",
        "issue",
        "severity",
        "symptoms",
        "observationTime"
      ],
      "properties": {
        "crop": {
          "type": "string",
          "enum": ["grape"]
        },
        "variety": {
          "type": "string"
        },
        "fieldBlock": {
          "type": "string"
        },
        "issue": {
          "type": "string",
          "enum": ["powdery_mildew", "heat_stress", "other"]
        },
        "severity": {
          "type": "string",
          "enum": ["low", "moderate", "high"]
        },
        "symptoms": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string"
          }
        },
        "observationTime": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "normalization": {
      "type": "object",
      "additionalProperties": false,
      "required": ["leafWetness", "windEstimateKph"],
      "properties": {
        "temperatureC": {
          "type": "number",
          "minimum": -30,
          "maximum": 70
        },
        "leafWetness": {
          "type": "string",
          "enum": ["dry", "damp", "wet", "unknown"]
        },
        "windEstimateKph": {
          "type": "number",
          "minimum": 0,
          "maximum": 120
        }
      }
    },
    "location": {
      "type": "object",
      "additionalProperties": false,
      "required": ["lat", "lon"],
      "properties": {
        "lat": {
          "type": "number",
          "minimum": -90,
          "maximum": 90
        },
        "lon": {
          "type": "number",
          "minimum": -180,
          "maximum": 180
        }
      }
    },
    "status": {
      "type": "string",
      "enum": ["draft", "confirmed", "logged"]
    },
    "schemaVersion": {
      "type": "string",
      "const": "1.0.0"
    },
    "deterministicChecksum": {
      "type": "string",
      "pattern": "^sha256:[A-Fa-f0-9]{8,}$"
    }
  }
}
